---
- name: check if system reboot is required
  hosts: all
  become: yes
  tasks:
    - name: check if system reboot is required
      become: true
      stat:
        path: /var/run/reboot-required
      register: reboot_required
    - debug:
        msg: "Reboot is required"
      when: reboot_required.stat.exists

    - name: Extract Second Line of df Output
      set_fact:
        second_line: "{{ ansible_hostname }} - {{ reboot_required }}"

    - name: Send Telegram Message
      uri:
        url: "https://api.telegram.org/bot957532885:AAHGKNEHBthFlWTogxjcM45k4ZmoMHC15sc/sendMessage"
        method: POST
        body_format: json
        body:
          chat_id: "-1001770439301"
          #text: "Disk space usage: {{ used_percentage }}"
          text: "need to rebote: {{ second_line }}"
